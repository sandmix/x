<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Math Practice</title>

<style>
body{
 font-family:Arial;
 margin:12px;
 font-size:22px;
}

h2{text-align:center;}

.columns{
 display:grid;
 grid-template-columns:repeat(4,1fr);
 gap:12px;
}

@media(max-width:900px){
 .columns{
  grid-template-columns:repeat(2,1fr);
 }
}

.column{
 border:2px solid #ccc;
 border-radius:12px;
 padding:10px;
}

.timer{
 text-align:center;
 font-weight:bold;
 margin-bottom:10px;
}

.exercise{
 display:flex;
 justify-content:center;
 align-items:center;
 margin:6px 0;
}

.exercise span{
 width:32px;
 text-align:center;
}

.exercise input{
 width:70px;
 font-size:22px;
 text-align:center;
 margin-left:6px;
}

.correct{background:#b6f5b6;}
.wrong{background:#f7b1b1;}

#submitBtn{
 display:none;
 width:100%;
 padding:14px;
 font-size:22px;
 margin-top:20px;
 position:sticky;
 bottom:10px;
}

#codeBox{
 margin-top:20px;
 text-align:center;
 font-size:28px;
 font-weight:bold;
}

/* CONFETTI */
.confetti{
 position:fixed;
 width:10px;
 height:10px;
 top:-10px;
 opacity:0.9;
 animation:fall linear forwards;
 z-index:9999;
}

@keyframes fall{
 to{
  transform:translateY(100vh) rotate(720deg);
  opacity:0;
 }
}
</style>
</head>

<body>

<h2>Math Practice</h2>

<div class="columns" id="worksheet"></div>
<button id="submitBtn" onclick="generateCode()">SUBMIT</button>
<div id="codeBox"></div>

<script>
const COLS=4;
const EX_PER_COL=28;
const worksheet=document.getElementById("worksheet");

let columnsFinished=0;

function formatTime(ms){
 const s=Math.floor(ms/1000);
 return String(Math.floor(s/60)).padStart(2,'0')+":"+
        String(s%60).padStart(2,'0');
}

function focusNextInput(currentInput){
 const allInputs = Array.from(document.querySelectorAll(".exercise input"));
 const index = allInputs.indexOf(currentInput);

 for(let i=index+1;i<allInputs.length;i++){
  if(!allInputs[i].disabled){
   allInputs[i].focus();
   return;
  }
 }
}

function generateExercise(){
 const ops=["+","-","Ã—","Ã·"];
 const op=ops[Math.floor(Math.random()*ops.length)];
 let a,b,r;

 if(op==="+"||op==="-" ){
  a=Math.floor(Math.random()*90)+10;
  b=Math.floor(Math.random()*90)+1;
  if(op==="-"&&b>a)[a,b]=[b,a];
  r=(op==="+")?a+b:a-b;
 }else{
  b=Math.floor(Math.random()*9)+1;
  a=Math.floor(Math.random()*9)+1;
  if(op==="Ã·") a*=b;
  r=(op==="Ã—")?a*b:a/b;
 }
 return{a,b,op,r};
}

/* CONFETTI FUNCTION */
function launchConfetti(){
 for(let i=0;i<200;i++){
  const conf=document.createElement("div");
  conf.className="confetti";
  conf.style.left=Math.random()*100+"vw";
  conf.style.backgroundColor=
   "hsl("+Math.random()*360+",100%,50%)";
  conf.style.animationDuration=(Math.random()*2+2)+"s";
  document.body.appendChild(conf);

  setTimeout(()=>conf.remove(),4000);
 }
}

// CREATE COLUMNS
for(let c=0;c<COLS;c++){
 (function(colIndex){

  const col=document.createElement("div");
  col.className="column";

  col.innerHTML=
   "<h3>Column "+(colIndex+1)+"</h3>"+
   "<div class='timer'>Time: 00:00</div>";

  const timerDiv=col.querySelector(".timer");

  let startTime=null;
  let interval=null;
  let finished=false;

  function startTimer(){
   if(startTime) return;
   startTime=Date.now();
   interval=setInterval(()=>{
    timerDiv.textContent="Time: "+formatTime(Date.now()-startTime);
   },500);
  }

  for(let i=0;i<EX_PER_COL;i++){
   const ex=generateExercise();
   let attempts=0;

   const row=document.createElement("div");
   row.className="exercise";

   row.innerHTML=
    "<span>"+ex.a+"</span>"+
    "<span>"+ex.op+"</span>"+
    "<span>"+ex.b+"</span>"+
    "<span>=</span>"+
    "<input type='number'>";

   const input=row.querySelector("input");

   input.addEventListener("input",()=>{
    if(input.disabled) return;
    startTimer();

    const val=Number(input.value);

    if(val===ex.r){
     input.className="correct";
     input.disabled=true;
     focusNextInput(input);
    }else{
     attempts++;
     input.className="wrong";

     if(attempts>=6){
      input.value=ex.r;
      input.disabled=true;
      focusNextInput(input);
     }
    }

    const disabledCount =
     col.querySelectorAll("input:disabled").length;

    if(disabledCount===EX_PER_COL && !finished){
     finished=true;
     columnsFinished++;
     clearInterval(interval);

     if(startTime){
      timerDiv.textContent=
       "Finished: "+formatTime(Date.now()-startTime);
     }else{
      timerDiv.textContent="Finished: 00:00";
     }

     if(columnsFinished===COLS){
      document.getElementById("submitBtn").style.display="block";
      launchConfetti();   // ðŸŽ‰ CONFETTI HERE
     }
    }
   });

   col.appendChild(row);
  }

  worksheet.appendChild(col);

 })(c);
}

function generateCode(){
 const correctExercises=
  document.querySelectorAll(".correct").length;

 const today=new Date();
 const day=today.getDate();
 const month2=(today.getMonth()+1)*2;
 const correct2=correctExercises*2;

 const code=
  String(day)+
  String(month2).padStart(2,'0')+
  String(columnsFinished)+
  String(correct2);

 document.getElementById("codeBox").textContent=
  "RESULT CODE: "+code;
}
</script>

</body>
</html>
